{% comment %}
  Related Products Section
  
  Displays product recommendations based on Shopify's recommendation algorithm.
  Automatically shows related products on product pages.
{% endcomment %}

{{ 'component-product-card.css' | asset_url | stylesheet_tag }}
{{ 'component-product-price.css' | asset_url | stylesheet_tag }}

{% style %}
  .section-{{ section.id }}-padding {
    padding-top: {{ section.settings.padding_top | times: 0.75 | round: 0 }}px;
    padding-bottom: {{ section.settings.padding_bottom | times: 0.75 | round: 0 }}px;
  }

  @media screen and (min-width: 750px) {
    .section-{{ section.id }}-padding {
      padding-top: {{ section.settings.padding_top }}px;
      padding-bottom: {{ section.settings.padding_bottom }}px;
    }
  }

  .related-products {
    display: block;
    position: relative;
  }

  .related-products__heading {
    margin: 0 0 3.2rem;
    text-align: center;
    font-weight: 600;
    letter-spacing: 0.04em;
    line-height: 1.2;
  }

  .related-products__heading.h0 {
    font-size: 3.6rem;
  }

  .related-products__heading.h1 {
    font-size: 2.8rem;
  }

  .related-products__heading.h2 {
    font-size: 2rem;
  }

  /* Grid Layout */
  .related-products__grid {
    display: grid;
    grid-template-columns: repeat({{ section.settings.columns_desktop }}, 1fr);
    gap: 2rem;
    list-style: none;
    margin: 0;
    padding: 0;
  }

  /* Carousel Layout */
  .related-products__carousel-wrapper {
    position: relative;
    display: flex;
    align-items: center;
    gap: 1.6rem;
  }

  .related-products__carousel {
    flex: 1;
    overflow: hidden;
  }

  .related-products__carousel .swiper-wrapper {
    list-style: none;
    margin: 0;
    padding: 0;
  }

  .related-products__carousel .swiper-slide {
    height: auto;
  }

  .related-products__nav {
    width: 44px;
    height: 44px;
    padding: 0;
    background: #ffffff;
    border: 1px solid #e0e0e0;
    border-radius: 50%;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
    color: #000000;
    transition: all 0.2s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
    cursor: pointer;
    z-index: 1;
  }

  .related-products__nav.swiper-button-next, 
  .related-products__nav.swiper-button-prev {
    top: 40% !important;
  }

  .related-products__nav::after,
  .related-products__nav::before {
    display: none !important;
    content: none !important;
  }

  .related-products__nav svg {
    width: 20px;
    height: 20px;
    display: block;
    color: #121212;
    transition: color 0.2s ease;
  }

  .related-products__nav:hover {
    background: #f8f8f8;
    border-color: #d0d0d0;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.12);
    transform: scale(1.05);
  }

  .related-products__nav:hover svg {
    color: #000000;
  }

  .related-products__nav.swiper-button-disabled {
    opacity: 0.3;
    cursor: not-allowed;
    pointer-events: unset;
  }

  .related-products__nav.swiper-button-disabled:hover {
    background: #ffffff;
    border-color: #e0e0e0;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
    transform: none;
  }

  .no-recommendations {
    display: flex;
    justify-content: center;
  }

  @media screen and (max-width: 989px) {
    .related-products__grid {
      grid-template-columns: repeat({{ section.settings.columns_mobile }}, 1fr);
      gap: 1.2rem;
    }

    .related-products__nav {
      display: none !important;
    }

    .related-products__carousel-wrapper {
      gap: 0;
    }
  }

  @media screen and (max-width: 749px) {
    .related-products__heading.h0 {
      font-size: 2.8rem;
    }

    .related-products__heading.h1 {
      font-size: 2.2rem;
    }

    .related-products__heading.h2 {
      font-size: 1.6rem;
    }

    .related-products__heading {
      margin-bottom: 2.4rem;
    }
  }

  @media screen and (min-width: 768px) and (max-width: 1023px) {
    .related-products__nav {
      width: 36px;
      height: 36px;
    }

    .related-products__nav svg {
      width: 18px;
      height: 18px;
    }
  }

  @media screen and (min-width: 1024px) and (max-width: 1279px) {
    .related-products__nav {
      width: 40px;
      height: 40px;
    }

    .related-products__nav svg {
      width: 19px;
      height: 19px;
    }
  }
{% endstyle %}

{%- liquid
  assign products_to_show = section.settings.products_to_show
  assign layout_style = section.settings.layout_style | default: 'grid'
-%}

<div class="color-{{ section.settings.color_scheme }} gradient section-{{ section.id }}-padding">
  {% if layout_style == 'carousel' %}
    <related-products-carousel data-section-id="{{ section.id }}">
      <product-recommendations
        class="related-products page-width isolate{% if settings.animations_reveal_on_scroll %} scroll-trigger animate--slide-in{% endif %}"
        data-url="{{ routes.product_recommendations_url }}?section_id={{ section.id }}&product_id={{ product.id }}&limit={{ products_to_show }}&intent=related"
        data-layout="{{ layout_style }}"
      >
        {% if recommendations.performed and recommendations.products_count > 0 %}
          <h2 class="related-products__heading {{ section.settings.heading_size }}">
            {{ section.settings.heading }}
          </h2>
          <div class="related-products__carousel-wrapper">
            <button class="swiper-button-prev related-products__nav" type="button" aria-label="Previous">
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20" fill="none">
                <path d="M12 16L6 10L12 4" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            </button>
            <div id="related-products-{{ section.id }}" class="related-products__carousel swiper">
              <ul class="swiper-wrapper" role="list">
                {% for recommendation in recommendations.products %}
                  <li class="swiper-slide">
                    {% render 'component-product-card',
                      card_product: recommendation,
                      show_vendor: section.settings.show_vendor,
                      enable_swatches: section.settings.enable_swatches,
                      swatch_trigger: section.settings.swatch_trigger,
                      swatch_type: section.settings.swatch_type,
                      media_aspect_ratio: section.settings.image_ratio,
                      quick_add: section.settings.enable_quick_add,
                      section_id: section.id
                    %}
                  </li>
                {% endfor %}
              </ul>
            </div>
            <button class="swiper-button-next related-products__nav" type="button" aria-label="Next">
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20" fill="none">
                <path d="M8 16L14 10L8 4" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            </button>
          </div>
        {% endif %}
      </product-recommendations>
    </related-products-carousel>
  {% else %}
    <product-recommendations
      class="related-products page-width isolate{% if settings.animations_reveal_on_scroll %} scroll-trigger animate--slide-in{% endif %}"
      data-url="{{ routes.product_recommendations_url }}?section_id={{ section.id }}&product_id={{ product.id }}&limit={{ products_to_show }}&intent=related"
      data-layout="{{ layout_style }}"
    >
      {% if recommendations.performed and recommendations.products_count > 0 %}
        <h2 class="related-products__heading {{ section.settings.heading_size }}">
          {{ section.settings.heading }}
        </h2>
        <ul class="related-products__grid" role="list">
          {% for recommendation in recommendations.products %}
            <li class="related-products__grid-item">
              {% render 'component-product-card',
                card_product: recommendation,
                show_vendor: section.settings.show_vendor,
                enable_swatches: section.settings.enable_swatches,
                swatch_trigger: section.settings.swatch_trigger,
                swatch_type: section.settings.swatch_type,
                media_aspect_ratio: section.settings.image_ratio,
                quick_add: section.settings.enable_quick_add,
                section_id: section.id
              %}
            </li>
          {% endfor %}
        </ul>
      {% endif %}
    </product-recommendations>
  {% endif %}
</div>

<script src="{{ 'product-recommendations.js' | asset_url }}" type="module"></script>
<script src="{{ 'component-product-card.js' | asset_url }}" type="module"></script>
{% if section.settings.layout_style == 'carousel' %}
  <script src="{{ 'section-related-products.js' | asset_url }}" type="module"></script>
{% endif %}

{% schema %}
{
  "name": "Related products",
  "tag": "section",
  "class": "section",
  "enabled_on": {
    "templates": ["product"]
  },
  "settings": [
    {
      "type": "paragraph",
      "content": "Dynamic recommendations use order and product information to change and improve over time. [Learn more](https://help.shopify.com/themes/development/recommended-products)"
    },
    {
      "type": "inline_richtext",
      "id": "heading",
      "default": "You may also like",
      "label": "Heading"
    },
    {
      "type": "select",
      "id": "heading_size",
      "options": [
        {
          "value": "h2",
          "label": "Small"
        },
        {
          "value": "h1",
          "label": "Medium"
        },
        {
          "value": "h0",
          "label": "Large"
        }
      ],
      "default": "h1",
      "label": "Heading size"
    },
    {
      "type": "header",
      "content": "Layout"
    },
    {
      "type": "select",
      "id": "layout_style",
      "label": "Style",
      "options": [
        {
          "value": "grid",
          "label": "Grid"
        },
        {
          "value": "carousel",
          "label": "Carousel"
        }
      ],
      "default": "grid",
      "info": "Display products in a grid or carousel slider"
    },
    {
      "type": "range",
      "id": "products_to_show",
      "min": 2,
      "max": 10,
      "step": 1,
      "default": 4,
      "label": "Maximum products to show"
    },
    {
      "type": "range",
      "id": "columns_desktop",
      "min": 2,
      "max": 6,
      "step": 1,
      "default": 4,
      "label": "Number of columns on desktop",
      "info": "Only applies to grid layout"
    },
    {
      "type": "header",
      "content": "Product card"
    },
    {
      "type": "select",
      "id": "image_ratio",
      "options": [
        {
          "value": "adapt",
          "label": "Adapt to image"
        },
        {
          "value": "portrait",
          "label": "Portrait"
        },
        {
          "value": "square",
          "label": "Square"
        }
      ],
      "default": "adapt",
      "label": "Image ratio"
    },
    {
      "type": "checkbox",
      "id": "show_vendor",
      "default": false,
      "label": "Show vendor"
    },
    {
      "type": "select",
      "id": "enable_quick_add",
      "default": "standard",
      "label": "Quick add",
      "info": "Show quick add button on product cards",
      "options": [
        {
          "value": "standard",
          "label": "Standard"
        },
        {
          "value": "none",
          "label": "None"
        }
      ]
    },
    {
      "type": "header",
      "content": "Variant swatches"
    },
    {
      "type": "checkbox",
      "id": "enable_swatches",
      "default": true,
      "label": "Enable swatches",
      "info": "Show variant swatches on product cards"
    },
    {
      "type": "text",
      "id": "swatch_trigger",
      "label": "Swatch trigger",
      "default": "Color",
      "info": "Product option name to display as swatches (e.g., 'Color', 'Size')"
    },
    {
      "type": "select",
      "id": "swatch_type",
      "label": "Swatch type",
      "options": [
        {
          "value": "color",
          "label": "Color based"
        },
        {
          "value": "image",
          "label": "Image based"
        }
      ],
      "default": "image",
      "info": "Display swatches using color values or variant images"
    },
    {
      "type": "header",
      "content": "Colors"
    },
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "Color scheme",
      "default": "scheme-1"
    },
    {
      "type": "header",
      "content": "Mobile"
    },
    {
      "type": "select",
      "id": "columns_mobile",
      "default": "2",
      "label": "Number of columns on mobile",
      "info": "Only applies to grid layout",
      "options": [
        {
          "value": "1",
          "label": "1 column"
        },
        {
          "value": "2",
          "label": "2 columns"
        }
      ]
    },
    {
      "type": "header",
      "content": "Section padding"
    },
    {
      "type": "range",
      "id": "padding_top",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "Top padding",
      "default": 36
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "Bottom padding",
      "default": 36
    }
  ],
  "presets": [
    {
      "name": "Related products"
    }
  ]
}
{% endschema %}
